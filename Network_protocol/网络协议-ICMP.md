
* 本文主要内容为**刘超**老师在极客时间上的《趣谈网络协议》课程学习笔记

----

### ICMP 协议 --- 互联网控制报文协议

> 网络包在异常复杂的网络环境中传输，会遇到各种问题，需要传回问题的信息

* ICMP的报文封装在 IP 的包里面

![](https://github.com/LiuChuang0059/large_file/blob/master/pic/g526u.jpg)

> ICMP.的报文有很多的类型，不同的类型有不同的代码。 最常用类型是主动请求8 ，主动请求的应答为 0

----

### 查询报文的类型

* 常用的 ping 是查询报文，是一种主动请求，并且获得主动应答的 ICMP 协议 。

* 对 ping 的主动请求进行网络抓包 -- ICMP ECHO REAUEST； 主动请求的回复 ---- ICMP ECHO REPLY

* 相比于 原声的ICMP，多了两个字段 ； 一个是标识符 ； 一个是序号
> 去两队侦查兵，一队是侦查战况的，一队是去查找水源的，要有个标识才能区分。另一个是序号,派出去10个回来10个 就说明状况不错


### 差错报文类型

> 异常情况发起的，报告发生了不好的事情


* 终点不可达 -- 3 ：
	* 网络不可达 0 ： 找不到地方
	* 主机不可达 1 ：找到地方没人
	* 协议不可达 2 ： 找到地方找到人， 对不上协议
	* 端口不可达 3 ：
	* 需要进行分片单设置了不分片位：

* 源站抑制 --- 4 ：
> 让源站放慢发送速度

* 时间超时 -- 11 ：
> 超过网络包生存时间还没送到

* 路由重定向 -- 5 ：
> 下次发给另一个路由器

-----

### ping ： 查询报文类型：

#### 1. 同一个局域网

![](https://github.com/LiuChuang0059/large_file/blob/master/pic/8u5sz.jpg)

* 源主机首先会构建一个 ICMP请求数据包，ICMP 数据包含：
	* 类型字段： 请求数据包 字段为8
	* 顺序号 ： 区分连续 ping 时候发出的多个数据包，每发出一个，顺序号会自动加1
	* 计算往返时间 RTT 报文的数据部分加入发送时间

* 在规定的时间内，源主机如果没有接到ICMP 的应答包，则说明主机不可达； 如果接收到了 ICMP 应答包，则说明目标主机可达

#### 2. 跨网段

* 涉及网关的转发和路由器的转发等

#### 3. 可控范围

* 需要一个网络拓扑图 ： 清楚的知道一个网络包从源地址到目标地址需要经过哪些设备， 逐个 ping 这些设备

----

### Traceroute

> 暂留













































