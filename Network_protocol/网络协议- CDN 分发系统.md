
* 本文主要内容为**刘超**老师在极客时间上的《趣谈网络协议》课程学习笔记

----

> 上网的附近都有数据中心，数据中心里面部署一部分机器，形成一个缓存的集群来缓存部分数据，用户访问数据的时候，就可以**就近访问**

---

### 1. CDN 分发系统架构

![](https://github.com/LiuChuang0059/large_file/blob/master/pic/ogotl.jpg)

1. 边缘节点： 分布在各个地方的各个数据中心的节点

2. 区域节点： 规模更大，缓存的数据更多，命中的概率更高

3. 中心节点： 更大更多，如果还不命中，返回源网站访问

-----

### 2. 客户端如何找到相应的边缘节点
> 类似于 基于 DNS 的全局负载均衡。

![](https://github.com/LiuChuang0059/large_file/blob/master/pic/6qom6.jpg)

1. 存在 CDN 之后， 访问 www.web.com . 在 web.com 权威 DNS 服务器上，会设置一个 CNAME 别名，指向另一个域名  www.web.cdn.com 返回给 本地 DNS 服务器

2. 本地 DNS 服务器得到新的域名时候，解析这个域名； 接着访问 web.cdn.com 的权威 DNS服务器
> 是 CDN 自己的权威 DNS 服务器，继续设置一个 CNAME，指向另一个域名---> CDN 的全局负载均衡

3.  CDN 的 全局负载均衡器会为用户选择一台合适的缓存服务器提供服务
* 根据 用户 IP 地址，判断哪一台服务器离得近
* 根据用户的运营商
* 根据 URL 中携带的内容名称，判断哪一台服务器上有用户的内容
* 查询每个服务器的负载情况，哪一台还有服务能力

4. CDN 的 全局负载均衡器 返回一台缓存服务器的 IP 地址， 本地 DNS 服务器缓存这个 IP 地址，将 IP 返回给 客户端

5. 客户端访问中国边缘节点，下载资源，传送到终端

6. 如果边缘节点没有， 则向上一级请求

-----

### 3. CDN 缓存的内容

#### 1. 流媒体

* 流媒体是连续的，因此可以预先缓存，或者预先推送到用户的客户端

* 流媒体的数据量大，出现向上一级拉取的情况，压力大，往往采取主动推送的模式，将热点数据轰动推送到边缘节点

* CDN 提供 流媒体的预处理
> 对视频进行分片，使得客户端可以选择不同的码率加载不同的分片 --- 超清 高清 流畅

----

### 4. 动态 CDN

#### 1. 边缘计算的模式
* 将数据的逻辑计算和储存也放在边缘的节点，从源数据同步得到数据，在边缘节点计算

#### 2. 路径优化

* 数据的下发可以通过 CDN 网络对路径进行优化。
> 能够找到离源站很近的边缘节点，找到离用户近的边缘节点。所以 可以选择一个更好的路径







