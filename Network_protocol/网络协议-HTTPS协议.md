
* 本文主要内容为**刘超**老师在极客时间上的《趣谈网络协议》课程学习笔记

----

> HTTPS 协议 ： 需要加密的时候 HTTPS


## 1. HTTP 协议的保密

### 1. 对称加密
> 对称加密算法中， 加密和解密使用的密钥是相同的

* 约定一个密钥，发送请求的时候使用密钥进行加密；对应的使用密钥解密；
> 但是约定的密钥也需要在互联网上传输，也有可能被截获


### 2. 非对称加密
> 加密和解密的密钥不同， 一把是作为公开的公钥，另外一把是私钥，公钥加密的信息只有私钥可以解开，私钥加密只有公钥解开

* 客户端和网站分别有 一对 公钥私钥，
> 客户端发送的时候使用网站的公钥，网站给客户端发送消息时候，使用客户端的公钥。


### 3. 数字证书

**如何鉴定公钥匙对的**


* 先创建私钥，再创建对应的公钥，之后需要**证书**证明身份。

* 证书里面；

	* 公钥
	* 证书发布机构和有效期

* 证书的生成需要发起证书请求， 请求发送给权威机构认证 ----- 机构称为 CA -  Certificate Authority

* CA 使用自己的私钥给网站公钥签名，形成网站的证书

* CA 公钥的 验证需要更上一层的 CA -- root CA **层层授信背书** 模式

---

## 2. HTTPS 的工作模式

> 非对称加密的性能不如对称加密
> HTTPS 将两者结合， 非对称加密主要用来传输对称加密的 密钥， 而双方数据的通信使用对称加密进行

![](https://github.com/LiuChuang0059/large_file/blob/master/pic/1yc6n.jpg)
![](https://github.com/LiuChuang0059/large_file/blob/master/pic/08zrg.jpg)



1.  客户端先发送 Client Hello 消息到服务器， 明文传输 TLS 版本信息，**加密套件候选**，压缩算法候选等信息，还有一个随机数

2.  服务器 返回 Sever Hello 消息，告知客户端，服务器使用的协议版本，加密套件，压缩算法，和一个随机数。

3. 之后 服务器发送一个 证书，之后发送 Sever Hello Done

4. 客户端进行 CA 检验，不断向上追溯 CA，直到一个授信的 CA

5. 证书验证通过，客户端计算产生随机数字 Pre-master, 使用证书中的公钥加密，Client key Exchange 发送给服务器，服务器通过私钥解密

6.  客户端和服务器现在都有三个随机数， 在服务器和客户端产生相同的**对称密钥**

7. 客户端发送 Change Clipher Spec， 以后都采用协商的通信密钥和加密算法，之后在发送一个 Encrypted Handshake Message ，使用协商密钥进行加密，发送给服务器用于数据与握手验证。

8. 同样，服务器也发送 Change Clipher Spec， 以后都采用协商的通信密钥和加密算法，之后在发送一个 Encrypted Handshake Message ，使用协商密钥进行加密，发送给客户端用于数据与握手验证。

9. 之后就可以通过对称密钥进行加密传输




























