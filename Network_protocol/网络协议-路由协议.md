
* 本文主要内容为**刘超**老师在极客时间上的《趣谈网络协议》课程学习笔记

----

**出了网关，会有很多路由器，如何选择**


### 路由器配置--- 路由表

> 网络包传入到路由器，根据本地的转发信息库，决定正确的转发流量 --- 路由表

* 每个路由表有很多路由规则，每条规则包含

1. 目的网络

2. 出口设备： 从哪个口扔包

3. 下一跳网关 ： 下一个路由器的地址


**使用 route 命令和 ip route 命令进行查询配置**

```python
$ ip route add 10.176.48.0/20 via 10.173.32.1 dev eth0
# 要去 10.176.48.0 这个目标网络，从 eth0出去， 经过 10.173.32.1

```

-----

### 配置策略路由

* 配置多个路由表； 根据 IP 地址 入口设备 等选择 路由表

```python
$ ip rule add from 192.168.1.0/24 table 10  # 从这个网段来的 使用table 10 中的路由表
$ ip rule add from 192.168.2.0/24 table 20

```


----

### 动态路由算法


> 上面的是静态的路由， 网络环境复杂多变，修改复杂

> 动态路由器，根据协议算法生成动态路由表，随着网络运行状况的变化而变化

**寻找最短路径的问题**



#####  距离矢量路由法 ---  Bellman-Ford



#####  链路状态路由法 --- Dijkstra

 * 每个路由器启动的时候获取和自己邻居的距离，并将链路状态发送到整个网络

 * 每个路由器都能够在本地构建一个完整的图， 使用 Dijkstra算法，寻找最短路径

 * 更新的时候，只广播更新的或者改变的网络拓扑




----

### 动态路由协议

##### 基于链路状态路由算法的 OSPF

* 广泛应用于数据中心的内部，用于路由决策----成为**内部网关协议** IGP


* OSPF 可以发现多个最短的路径，在多个路径中进行负载均衡 --- 等价路由

![](https://github.com/LiuChuang0059/large_file/blob/master/pic/3to8r.jpg)


> 等价路由，可以分摊流量； 当一条路不同的时候走另一条路

##### 基于距离矢量路由算法的 BGP

> 外网的路由协议

* 每个数据中心都有自己的 Policy，
> 哪些可以通过，哪些不能通过

* 网络世界里面，存在着自治系统， Autonomous System

	 * Stub AS：对外只有一个连接， 不会传输其他 As 的包 ： 个人或者小公司
	 * Multihomed AS：可能有多个连接连到其他的 AS  ，大多拒绝为其他的AS传输包 ： 大公司
	 * Transit AS：有多个连接连到其他的 AS， 并且可以帮助其他的 AS传输包， 例如主干网



![](https://github.com/LiuChuang0059/large_file/blob/master/pic/1s0xq.jpg)

* 1. eBGP ： 自治系统的边界路由器之间使用eBGP 广播路由

* 2. iBGP ： 内部的路由器找到达到外网目的地的边界路由器；
































